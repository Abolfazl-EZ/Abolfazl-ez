var rating_form_vars={selector:".rf_item:not(.spinner), .rf_ttip",item_half_index:-1,item_half_class:"",item_full_class:"",item_full_length:-1,item_all_length:-1,is_comment_review:!1,review_rating_click:!1,review_same_rating_click:!1,review_rating:0,message_timer:0,limit_time_left:0,limit_wait_time:null,is_animating:!1,tooltip_pos_TB:"top",tooltip_pos_LR:"center",tooltip_arrow_pos_TB:"bottom",tooltip_arrow_pos_LR:"center"};function rating_form_is_json(t){try{return JSON.parse(t)&&!!t}catch(t){return!1}}function rating_form_apply_data(t){var r=t.checks,a=t.parent,i=a.find(".rating_form"),e=a.find(rating_form_vars.selector),n=e.length,s=n-e.not(".hover").length,o=!!i.parent().hasClass("rf_rtl"),_=o?0<e.find("img").length?"-half":"-rtl-half":"-half",f=0==n?"":e.attr("class").split(" ")[1];f=-1==f.indexOf(_)?f:f.replace(_,"");var l="-empty",g=!!i.hasClass("empty_on");g&&(f=f.replace(l,""));i.find(".rf_side,.def").length;var m=f+_,d=i.children("."+m).index();d=-1<d?o?d-1:d:-1;var c="rf_item "+f,v=r.hasOwnProperty("user_rating")?r.user_rating:"",p=r.hasOwnProperty("average")?r.average:"",h=r.hasOwnProperty("count")?r.count:"",u=r.hasOwnProperty("count_percent")?r.count_percent:"",w=r.hasOwnProperty("up_count")?r.up_count:"",y=r.hasOwnProperty("down_count")?r.down_count:"",x=r.hasOwnProperty("thankyou")?r.thankyou:"",C=r.hasOwnProperty("thankyou")?r.edit_rating:"",k=r.hasOwnProperty("icon_count")?r.icon_count:"",j=r.hasOwnProperty("icon_half")?r.icon_half:"";j-=1;var O=r.hasOwnProperty("scripts")?r.scripts:"";""!=O&&a.append(O),0==a.find(".rating_form .thankyou").length&&""!=x&&a.find(".rating_form .rf_side").append(x),a.find(".edit_rating_text").text(C);var Q=a.find(".rating_form .rf_average");Q.length&&Q.text(p);var P=a.find(".rating_form .rf_count");P.length&&P.text(h);var b=a.find(".rating_form .rf_count_percent");if(b.length){var A=b.text().replace(/\d+[.]?\d*/g,u);b.text(A)}var T=a.find(".rating_form .up_rated_txt");if(T.length){var R=T.text().replace(/\d+/g,w);T.text(R)}var H=a.find(".rating_form .down_rated_txt");if(H.length){var I=H.text().replace(/\d+/g,y);H.text(I)}if(v!=s){if(e.removeClass("hover"),-1<j&&(j=o?n-1-j:j),k+=-1<j?1:0,""!=v&&(j=-1,k=v),j!=d)if(-1<j){var S="rf_item "+f+_+" hover";e.eq(j).attr("class",S)}else e.eq(d).attr("class",c);var L=o?n-k:0,q=o?n:k;g&&e.hasClass(f+l)&&e.removeClass(f+l).addClass(f),e.slice(L,q).addClass("hover"),g&&e.not(".hover").removeClass(f).addClass(f+l),rating_form_vars.item_half_index=d,rating_form_vars.item_full_length=k}}function rating_form_restore_tooltip(t){var r=t.parents(".rating_form_wrap").find(".rating_form"),a=t.find(".rf_tooltip").text();0<a.length&&(t.attr("title",a),r.find(".rf_tooltip").remove())}jQuery(window).on("load",function(){jQuery(document).on("mouseenter",rating_form_vars.selector,function(){var r=jQuery(this),a=r.parents(".rating_form_wrap"),i=a.find(".rating_form"),t=rating_form_vars.selector,e=rating_form_vars.tooltip_pos_TB,n=rating_form_vars.tooltip_pos_LR,s=rating_form_vars.tooltip_arrow_pos_TB,o=rating_form_vars.tooltip_arrow_pos_LR;if(!i.is(".rating_form_result"))if(!i.is(".rating_form_result")&&i.attr("data-state")&&(rating_form_vars.is_comment_review||(rating_form_vars.is_comment_review=!0),rating_form_vars.review_rating=parseInt(jQuery(this).find('input[name="rf_rating"]').val())||0,0<rating_form_vars.review_rating&&(m?jQuery(this).find(t).slice(rating_form_vars.item_all_length-rating_form_vars.review_rating,rating_form_vars.item_all_length).addClass("hover"):jQuery(this).find(t).slice(0,rating_form_vars.review_rating).addClass("hover"))),i.is(".rf_hover_click"))r.click();else if(rating_form_vars.is_comment_review&&r.on("click",function(){var t=r.data("rating").replace("r","");i.find('input[name="rf_rating"]').val(t),console.log("rateClicked: "+rating_form_vars.review_rating),rating_form_vars.review_rating===t?(rating_form_vars.review_same_rating_click=!0,rating_form_vars.review_rating_click=!1,console.log("Same rating clicked: "+t)):(rating_form_vars.review_rating=t,console.log("Clicked Rating: "+rating_form_vars.review_rating),a.bind("mouseleave"),rating_form_vars.review_rating_click=!0)}),!i.is(".rating_form_result")){var _=a.find(".rf_settings[data-rf-tip-position]").data("rf-tip-position");null!=_&&(e=(_=_.split("-"))[0],n=_[1]);var f=a.find(".rf_settings[data-rf-tip-arrow-position]").data("rf-tip-arrow-position");null!=f&&(s=(f=f.split("-"))[0],o=f[1]);var l=i.find(t),g=-1<rating_form_vars.item_all_length?rating_form_vars.item_all_length:l.length;rating_form_vars.item_all_length=g,rating_form_vars.item_full_length=g-l.not(".hover").length;var m=!!a.hasClass("rf_rtl"),d=m?0<r.find("img").length?"-half":"-rtl-half":"-half",c=-1==g?"":l.attr("class").split(" ")[1];c=-1==c.indexOf(d)?c:c.replace(d,"");var v=!!i.hasClass("empty_on");v&&(c=c.replace("-empty",""));i.find(".def").length;var p=c+d,h=i.children("."+p).index();h=-1<h?m?h-1:h:-1,rating_form_vars.item_half_index=h,rating_form_vars.item_half_class="rf_item "+p;var u="rf_item "+c;if(rating_form_vars.item_full_class=u,l.removeClass("hover"),r.attr("title")){var w="",y=r.attr("title"),x=" rf_arrow_top",C=" rf_arrow_center";"bottom"==s&&(x=" rf_arrow_bottom"),"left"==o&&(C=" rf_arrow_left"),"right"==o&&(C=" rf_arrow_right"),r.append('<div class="rf_tooltip">'+y+'<div class="rf_arrow'+x+C+'"></div></div>'),w="0"==r.css("padding-right").replace(/\D/g,"")?r.width()/2+r.outerWidth()-r.width():"0"==r.css("padding-left").replace(/\D/g,"")?r.width()/2:r.outerWidth()/2;var k=r.find(".rf_tooltip"),j=k.outerWidth(),O=k.outerHeight(),Q=(k.css("top").replace(/\D/g,""),k.find(".rf_arrow").outerHeight()),P=k.find(".rf_arrow").css("margin-top").replace(/\D/g,""),b=k.find(".rf_arrow").css("margin-bottom").replace(/\D/g,"");Q=parseInt(Q)+parseInt(P)+parseInt(b);var A=r.outerWidth(),T=r.outerHeight(),R=r.position().top,H=r.position().left,I=R-O-Q,S=H-j/2+w;if("bottom"==e&&(I=R+T+Q),"left"==n?S=H:"right"==n&&(S=H-j+A),"center"==o&&"center"!=n){var L=A/j*100;"left"==n&&(L/=2),"right"==n&&(L=100-L/2),k.find(".rf_arrow_center").css("left",L+"%")}k.css({top:I+"px",left:S+"px"}),r.attr("title","")}if(0<r.find("img").length){var q=r.find("img").attr("src"),D=q.substring(0,q.lastIndexOf("/")+1);r.find("img").attr("src",D+"custom-full.png"),m?r.prevAll().find("img").attr("src",D+"custom-empty.png"):r.nextAll().find("img").attr("src",D+"custom-empty.png"),3<g&&(m?r.nextAll().find("img").attr("src",D+"custom-full.png"):r.prevAll().find("img").attr("src",D+"custom-full.png"))}-1<h&&l.eq(h).attr("class",u),v&&(r.hasClass(p)||r.attr("class",u),m?(r.nextAll().filter(t).attr("class",u),r.prevAll().filter(t).attr("class",u+"-empty")):(r.prevAll().filter(t).attr("class",u),r.nextAll().filter(t).attr("class",u+"-empty"))),r.addClass("hover"),3<g&&(m?r.nextAll().filter(t).addClass("hover"):r.prevAll().filter(t).addClass("hover"))}}),jQuery(document).on("mouseleave",rating_form_vars.selector,function(){var t=jQuery(this),r=t.parents(".rating_form_wrap"),a=r.find(".rating_form"),i=rating_form_vars.selector,e=rating_form_vars.item_half_index,n=rating_form_vars.item_full_class,s=rating_form_vars.item_all_length,o=rating_form_vars.item_full_length,_=!!r.hasClass("rf_rtl"),f=!!a.hasClass("empty_on");if(!a.is(".rating_form_result")){var l=a.find(i);if(l.removeClass("hover"),0<t.find("img").length){var g=t.find("img").attr("src"),m=g.substring(0,g.lastIndexOf("/")+1);l.find("img").attr("src",m+"custom-empty.png"),_?l.slice(s-o,s).find("img").attr("src",m+"custom-full.png"):l.slice(0,o).find("img").attr("src",m+"custom-full.png"),-1<e&&l.eq(e).find("img").attr("src",m+"custom-half.png")}f&&(_?rating_form_vars.is_comment_review?(l.slice(s-rating_form_vars.review_rating,s).attr("class",n),l.slice(0,s-rating_form_vars.review_rating).attr("class",l.attr("class")+"-empty")):(l.slice(s-o,s).attr("class",n),l.slice(0,s-o).attr("class",n+"-empty")):(l.slice(0,o).attr("class",n),rating_form_vars.is_comment_review?l.slice(rating_form_vars.review_rating,s).attr("class",n+"-empty"):l.slice(o,s).attr("class",n+"-empty"))),-1<e&&!rating_form_vars.is_comment_review&&l.eq(e).attr("class",rating_form_vars.item_half_class),_?rating_form_vars.is_comment_review?l.slice(s-rating_form_vars.review_rating,s).addClass("hover"):l.slice(s-o,s).addClass("hover"):rating_form_vars.is_comment_review?l.slice(0,rating_form_vars.review_rating).addClass("hover"):l.slice(0,o).addClass("hover"),rating_form_restore_tooltip(t),rating_form_vars.is_comment_review&&(rating_form_vars.review_same_rating_click?(l.removeClass("hover"),a.find('input[name="rf_rating"]').val(""),rating_form_vars.review_rating="",rating_form_vars.review_same_rating_click=!1,console.log("isCommentReview",rating_form_vars.is_comment_review),console.log("rateClicked",rating_form_vars.review_rating),console.log("reviewSameRatingClick",rating_form_vars.review_same_rating_click),console.log("reviewRatingClick",rating_form_vars.review_rating_click)):(_?t.nextAll().filter(i).addClass("hover"):t.prevAll().filter(i).addClass("hover"),t.addClass("hover")))}}),jQuery(document).on("click",rating_form_vars.selector,function(){var t=jQuery(this),n=jQuery(this).parents(".rating_form_wrap"),s=n.find(".rating_form"),r=n.find(".rating_stats"),a=n.data("rf-id");if(t.unbind("mouseleave"),rating_form_restore_tooltip(t),window.clearTimeout(rating_form_vars.message_timer),0<n.find(".rating_form .rated").length)return s.find(".def").not(".up_rated_txt,.down_rated_txt").hide(),s.find(".rated").show(),void(rating_form_vars.message_timer=setTimeout(function(){s.find(".def").not(".rated,.up_rated_txt,.down_rated_txt").show(),s.find(".rated").hide()},3e3));if(!rating_form_vars.is_animating&&!s.attr("data-state")&&(rating_form_vars.is_animating=!0,0===n.find(".rating_form_result").length)){var o=jQuery('.rating_form_wrap[data-id="'+a+'"]'),_=t.data("rating"),i=0!==t.find(".title").length,e=0!==s.find(".rating_score").length,f=0!==s.find(".rating_total").length,l=0!==n.find(".stats_on").length,g=0!==n.find(".user_stats_on").length,m=!1===f?"":s.find(".rating_total").text().replace(/[-+]?\d+/g,""),d=!1===e?"":s.find(".rating_score").text().replace(/(\d*[.])?\d+/g,"%s");t.parent().find(".rf_tooltip").remove();var c=void 0!==t.attr("title"),v=0!==n.find("[itemtype]").length,p=n.find(".rf_settings[data-rf-cig]").data("rf-cig"),h=n.find(".rating_form").data("edit-id"),u=0===n.find(".rating_before_content").length?"":n.find(".rating_before_content").html(),w=0===n.find(".rating_after_content").length?"":n.find(".rating_after_content").html(),y=!!n.find(".redirect_on").length,x=n.find(".rating_form").data("redirect-url"),C=n.find(".rating_form").data("redirect-params");C=void 0===C?"":C.replace(/%user_rating%/,_);var k=n.find(".rating_form").data("redirect-target"),j=y?window.open(x+C,k):"",O=n.find("[class*=spinner]").length?n.find("[class*=spinner]").attr("class").match(/spinner(\d+)_on/):null;s.hasClass("spinner_on")?(s.append('<span class="rf_item spinner cyto-spinner cyto-spin"></span>'),s.find(".rf_item:not(.spinner), .def").hide()):null===O?s.addClass("update"):(s.append('<span class="rf_item spinner cyto-spinner'+O[1]+' cyto-spin"></span>'),s.find(".rf_item:not(.spinner), .def").hide()),r.addClass("update"),t.attr("data-rating")&&jQuery.ajax({type:"POST",url:rating_form_script.ajaxurl,data:{action:"rating_form_rating_add",form_id:a,rated:_,title:i,score:e,total:f,stats:l,user_stats:g,tooltip:c,rich_snippet:v,custom_id_group:p,rates:m,txt_score:d,edit_rating:h,before_content:u,after_content:w},success:function(t){0<s.find(".spinner").length&&s.find(".spinner").remove(),s.hasClass("update")&&s.removeClass("update"),0<n.find(".rating_stats").length&&n.find(".rating_stats").remove();var r=!!rating_form_is_json(t)&&JSON.parse(t),a="";if(r.hasOwnProperty("rated")?a=r.rated:r.hasOwnProperty("login")?a=r.login:r.hasOwnProperty("limit")&&(a=r.limit),!1!==r&&""==a){var i=!!r.hasOwnProperty("hide_after_vote")&&r.hide_after_vote,e=!!r.hasOwnProperty("show_ty_after_vote")&&r.show_ty_after_vote;null!=h&&(r.user_rating=_),rating_form_apply_data({checks:r,parent:n}),y&&j.location,i&&(e?s.find(".rf_item,.def").not(".thankyou").remove():n.remove()),s.find(".rf_item,.up_rated_txt,.down_rated_txt").show(),o.not(n).find(".rating_form .thankyou").remove(),0<n.find(".rating_form .thankyou").length?(n.find(".rating_form .rating_total, .rating_form .rating_score").not(".thankyou").hide(),rating_form_vars.message_timer=setTimeout(function(){jQuery.when(n.find(".rating_form .thankyou").remove()).then(function(){n.find(".rating_form .rating_total, .rating_form .rating_score").not(".thankyou, .rated").show(),i&&e&&n.remove()})},3e3)):n.find(".rating_form .rating_total, .rating_form .rating_score").not(".thankyou, .rated").show()}else!1!==r&&""!=a&&0==n.find(".rating_form .rated").length&&(0<s.find(".thankyou").length&&s.find(".thankyou").remove(),s.find(".rf_item,.up_rated_txt,.down_rated_txt").show(),s.find(".rf_side").append(a),s.find(".rated").show(),rating_form_vars.limit_time_left=r.hasOwnProperty("time_left")?r.time_left:0,null==rating_form_vars.limit_wait_time&&0!=rating_form_vars.limit_time_left&&(rating_form_vars.limit_wait_time=setTimeout(function(){jQuery.when(n.find(".rating_form .rated").remove()).then(function(){console.log("Limit time's up. You can vote again!"),rating_form_vars.limit_wait_time=null,rating_form_vars.limit_time_left=0})},1e3*rating_form_vars.limit_time_left+2e3),console.log("limitTimeLeft: ",rating_form_vars.limit_time_left)),rating_form_vars.message_timer=setTimeout(function(){jQuery.when(n.find(".rating_form .rated").hide()).then(function(){n.find(".rating_form .def").not(".rated").show()})},3e3));rating_form_vars.is_animating=!1},error:function(t){console.log(t)}})}}),jQuery(document).on("click",".rating_total",function(){var n=jQuery(this),s=jQuery(this).parents(".rating_form_wrap"),o=s.find(".rating_form"),t=s.find(".rating_stats"),r=s.data("rf-id"),_=!!s.hasClass("rf_rtl"),a=0!==s.find(".stats_on").length,i=0!==s.find(".user_stats_on").length,e=s.find(".rating_total").text(),f=s.find(".rating_total .rf_count, .rating_total .rf_count_percent").text(),l=o.attr("data-state")?o.data("state"):"";if(0!=f.replace("%",""))if(0<t.length){var g=o.position().top-t.outerHeight()-10,m=o.position().top+o.outerHeight()+10,d=g;s.find(".rf_settings[data-rf-stats-position]").length&&(d=m),t.css({top:d,left:_?o.position().right:o.position().left}),o.toggleClass("rating_stats_active"),t.is(":visible")?t.fadeOut():0<t.length&&t.fadeIn()}else{var c={action:"show_rf_stats",form_id:r,stats:a,user_stats:i,rates:e,count:f,state:l};jQuery.ajax({type:"POST",url:rating_form_script.ajaxurl,data:c,beforeSend:function(){n.css("opacity","0.4")},success:function(t){s.append(t);var r=s.find(".rating_stats"),a=o.position().top-r.outerHeight()-10,i=o.position().top+o.outerHeight()+10,e=a;s.find(".rf_settings[data-rf-stats-position]").length&&(e=i),r.css({top:e,left:_?o.position().right:o.position().left}),r.show(),r.on("click",".rf_stats_close",function(){r.hide(),o.removeClass("rating_stats_active")}),n.css("opacity","1")},error:function(t){console.error(t,c)}})}})});